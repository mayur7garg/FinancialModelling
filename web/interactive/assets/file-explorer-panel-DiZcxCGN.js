var We=Object.defineProperty;var Ie=(t,e,r)=>e in t?We(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var M=(t,e,r)=>Ie(t,typeof e!="symbol"?e+"":e,r);import{s as Y}from"./chunk-DZLz74EQ.js";import{c as ge,d as je,n as Ee,s as le}from"./jotai-C7U7c6dd.js";import{t as He}from"./react-cj45iF1i.js";import{Er as Be,Pt as Te,kr as qe,vt as $e,w as Ve,xn as de}from"./cells-D2eha_-B.js";import"./react-dom-BjyRIiB0.js";import"./zod-U2NFpcFA.js";import{t as ce}from"./compiler-runtime-bbSa6V1W.js";import"./_Uint8Array-D5Z9rM2X.js";import"./isSymbol-xTSywenE.js";import"./_arrayMap-DQI2GUNb.js";import"./toString-CBnct2wx.js";import"./toNumber-CTOPJrpu.js";import"./toInteger-Bor4StOs.js";import"./isArrayLikeObject-DKyJYtr8.js";import"./_getTag-CVRrQL_Q.js";import"./_baseIsEqual-CVFfFJm2.js";import"./merge-Dvc5opZF.js";import"./_baseSlice-BWZ0PeaJ.js";import"./upperFirst-CBQfDRod.js";import"./_hasUnicode-3DIK_jNi.js";import"./capitalize-CBqvgOfA.js";import"./_arrayReduce-DV4IVFuG.js";import"./startCase-RfubwhHM.js";import"./_baseProperty-c4IQJQis.js";import"./now-BXqTLlmI.js";import"./debounce-BUM2losY.js";import"./tooltip-CJwdMp1K.js";import"./range-ZclXTdAh.js";import{d as Le,u as Ue}from"./hotkeys-jCLisiwR.js";import{t as Ke}from"./invariant-D5a0EE05.js";import{f as Ye}from"./utils-GFT-p9ER.js";import"./constants-CEISdYm1.js";import{_ as ie}from"./config-CULm_ZjE.js";import"./ErrorBoundary-Bu1xrDr8.js";import"./useEventListener-DVwjxFkt.js";import{t as Ze}from"./jsx-runtime-DmpivWpf.js";import"./clsx-BlAkgCmw.js";import{t as me}from"./cn-BaXqCYqP.js";import{n as Ge,t as I}from"./button-DCB7VoVL.js";import{bt as Je,rt as Qe}from"./dist-C6GW8SWp.js";import"./dist-BFSjfL-I.js";import{R as Xe,a as et,i as tt,o as at,r as it,s as rt}from"./Output-nN1GOw3k.js";import"./once-C5bmD4W5.js";import"./capabilities-MLRWIHmO.js";import"./cjs-Ck8KMDI1.js";import"./createReducer-CTvsuJZY.js";import{n as nt,r as pe}from"./requests-CftYh9v2.js";import"./preload-helper-BnutJmlU.js";import"./dist-0FJpM7wG.js";import"./dist-DrAMGx2E.js";import"./dist-CZkQ2hcE.js";import"./dist-BrS3KFEl.js";import"./dist-DvTgOH5F.js";import"./dist-YP2XXp1Z.js";import"./stex-xveX5l_T.js";import"./Deferred-NfAvvkGM.js";import"./uuid-D0hUC3Qw.js";import"./key-CaC9xuXQ.js";import{t as A}from"./use-toast-BBrPeu2N.js";import"./main-ChjX94eX.js";import"./marked.esm-BV7g2d65.js";import"./connection-DOETP_K0.js";import"./dist-CvIoRIOp.js";import"./useLifecycle-DiLWmtpP.js";import{n as ot}from"./useTheme-C1t46HlN.js";import{t as K}from"./createLucideIcon-DbfgBYhq.js";import{t as st}from"./arrow-left-qLn5JMUD.js";import{t as lt}from"./between-horizontal-start-DDhAeomy.js";import"./type-CnQq0uaD.js";import"./table-CTK995oK.js";import"./check-DqnGmZZE.js";import{_ as dt}from"./select-BkT3QHmw.js";import{n as ct,t as ye}from"./download-3twj9Xwh.js";import{t as mt}from"./chevron-right-Bu29x-gp.js";import{_ as he}from"./maps-BGCWjJqb.js";import"./toDate-CbcWqY6f.js";import{a as N,c as Z,p as pt,r as ht,t as ft}from"./dropdown-menu-CN5aVh8R.js";import{t as be}from"./copy-4VJP-N0g.js";import{t as ve}from"./download-BYnrx3yk.js";import{t as xt}from"./ellipsis-vertical-GzpLMS30.js";import{t as ut}from"./eye-off-B1gsplPc.js";import{n as we,r as gt,t as jt}from"./types-m5vJOc8S.js";import"./file-video-camera-BakM8DrE.js";import{t as ke}from"./file-plus-2-Cui0MyiU.js";import"./file-text-br2BVDBF.js";import"./file-D9scEdAT.js";import{t as yt}from"./spinner-DXjgT_d6.js";import"./MarimoErrorOutput-CAtwsmR1.js";import{t as bt}from"./refresh-ccw-DFz7B_fr.js";import{t as vt}from"./refresh-cw-CFk1MA73.js";import{t as wt}from"./save-CVBO-RzV.js";import"./input-BYmR6HBp.js";import"./state-HLf_9r-5.js";import{t as kt}from"./trash-2-YwvEZLT8.js";import{t as Ft}from"./triangle-alert-BBtcXh_3.js";import{i as Ct,n as Nt,t as Dt}from"./es-IayDfy8U.js";import"./badge-Dlbidp5Z.js";import"./Combination-ChP9ffHH.js";import"./dist-CLwJsV2W.js";import{t as O}from"./tooltip-fQCr9gxe.js";import"./menu-items-DwJgssBv.js";import"./useNonce-DJX1XgWY.js";import"./en-US-D9Lph-mE.js";import"./isValid-CJoeYwPo.js";import"./mode-BvhOdC_B.js";import{o as St}from"./alert-dialog-81myxzgR.js";import"./dialog-B0ZQRYmN.js";import"./usePress-BJP5uSM9.js";import"./SSRProvider-BufkqsXB.js";import"./useDateFormatter-Bt93nQ51.js";import"./context-CmoHMC3k.js";import"./useNumberFormatter-BCRD3Xiy.js";import"./shim-CL-N1TlJ.js";import"./numbers-Da0UyJ4q.js";import{n as W}from"./useEvent-2G6_06QI.js";import"./useDebounce-88MnHfxr.js";import{n as Fe}from"./ImperativeModal-wjVZ4eQS.js";import"./strings-DoNzvBC8.js";import{i as _t,n as Ce}from"./error-banner-C8bnn_Oj.js";import"./vega-loader.browser-BVwjVCQc.js";import"./precisionRound-B2LwJfpR.js";import"./defaultLocale-CNK_a8Z2.js";import"./defaultLocale-Mn032I1s.js";import{t as re}from"./copy-CvoiXuJX.js";import"./copy-icon-DNw8yyV3.js";import"./RenderHTML-BPePlDKV.js";import"./purify.es-Cz-BfAJO.js";import"./useRunCells-DyCvt_J0.js";import"./multi-map-DOgPLTwj.js";import"./emotion-is-prop-valid.esm-jr96H-64.js";import"./extends-BUnZS06R.js";import"./prop-types-CElKCMhv.js";import"./objectWithoutPropertiesLoose-DuRO3TFS.js";import{n as fe,t as Pt}from"./tree-CcvYWA8T.js";import{n as Ot,t as zt}from"./alert-Uyjokbhs.js";import{n as Ne}from"./useAsyncData-CXeJJDVW.js";import"./kbd-f3Vl6KVv.js";import{a as Mt}from"./renderShortcut-WvNIumsP.js";import{t as Rt}from"./LazyAnyLanguageCodeMirror-BmYv6_Y6.js";import"./popover-y-4eU0xo.js";import"./cell-link-C_YhUpui.js";import"./links-L8RfsBvj.js";import"./useIframeCapabilities-CE7UrR0d.js";import"./lazy-DGC5ohlw.js";import"./tabs-DmZtZQ_N.js";import"./command-hjwnCrLr.js";import"./table-D7dxF_z5.js";import"./formats-B6WeWt9C.js";import{n as At}from"./blob-ISoY06EG.js";import{t as Wt}from"./bundle.esm-DtrWSlr6.js";import{o as It}from"./focus-DkcYPAN0.js";import{t as Et}from"./links-Csa2d-xU.js";import{t as Ht}from"./icon-32x32-YsJOs0Ms.js";import{t as G}from"./Inputs-0YdYrZww.js";var Bt=K("copy-minus",[["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),De=K("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Se=K("list-tree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),Tt=K("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),qt=K("square-play",[["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}],["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}]]),$t=K("view",[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]]),Vt=Y(ce(),1),_=Y(He(),1),a=Y(Ze(),1),xe=new Map;const Lt=({file:t,onOpenNotebook:e})=>{let{theme:r}=ot(),{sendFileDetails:n,sendUpdateFile:i}=pe(),l=ge(Ye),c=ge(Be),[m,p]=(0,_.useState)(""),{data:o,isPending:f,error:j,setData:y,refetch:d}=Ne(async()=>{let s=await n({path:t.path}),u=s.contents||"";return p(xe.get(t.path)||u),s},[t.path]),g=async()=>{m!==(o==null?void 0:o.contents)&&await i({path:t.path,contents:m}).then(s=>{s.success&&(y(u=>({...u,contents:m})),p(m))})},v=(0,_.useRef)(m);if(v.current=m,(0,_.useEffect)(()=>()=>{if(!(o!=null&&o.contents))return;let s=v.current;s===o.contents?xe.delete(t.path):xe.set(t.path,s)},[t.path,o==null?void 0:o.contents]),j)return(0,a.jsx)(Ce,{error:j});if(f||!o)return null;let x=o.mimeType||"text/plain",D=x in ue,k=c&&o.file.isMarimoFile&&(t.path===c||t.path.endsWith(`/${c}`));if(!o.contents&&!D)return(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-6",children:[(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Name"}),(0,a.jsx)("div",{children:o.file.name}),(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Type"}),(0,a.jsx)("div",{children:x})]});let b=(0,a.jsxs)("div",{className:"text-xs text-muted-foreground p-1 flex justify-end gap-2 border-b",children:[(0,a.jsx)(O,{content:"Refresh",children:(0,a.jsx)(G,{size:"small",onClick:d,children:(0,a.jsx)(vt,{})})}),t.isMarimoFile&&!ie()&&(0,a.jsx)(O,{content:"Open notebook",children:(0,a.jsx)(G,{size:"small",onClick:s=>e(s),children:(0,a.jsx)(he,{})})}),(0,a.jsx)(O,{content:"Download",children:(0,a.jsx)(G,{size:"small",onClick:()=>{if(_e(x)){ct(Xe(o.contents,x),o.file.name);return}ye(new Blob([o.contents||m],{type:x}),o.file.name)},children:(0,a.jsx)(ve,{})})}),!_e(x)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O,{content:"Copy contents to clipboard",children:(0,a.jsx)(G,{size:"small",onClick:async()=>{await re(m)},children:(0,a.jsx)(be,{})})}),(0,a.jsx)(O,{content:Mt("global.save"),children:(0,a.jsx)(G,{size:"small",color:m===o.contents?void 0:"green",onClick:g,disabled:m===o.contents,children:(0,a.jsx)(wt,{})})})]})]});return x.startsWith("image/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(et,{base64:o.contents,mime:x})})]}):x==="text/csv"&&o.contents?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(tt,{contents:o.contents})})]}):x.startsWith("audio/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(it,{base64:o.contents,mime:x})})]}):x.startsWith("video/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(rt,{base64:o.contents,mime:x})})]}):x.startsWith("application/pdf")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(at,{base64:o.contents,mime:x})})]}):(0,a.jsxs)(a.Fragment,{children:[b,k&&(0,a.jsxs)(zt,{variant:"warning",className:"rounded-none",children:[(0,a.jsx)(Ft,{className:"h-4 w-4"}),(0,a.jsx)(Ot,{children:"Editing the notebook file directly while running in marimo's editor may cause unintended changes. Please use with caution."})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsx)(_.Suspense,{children:(0,a.jsx)(Rt,{theme:r==="dark"?"dark":"light",language:ue[x]||ue.default,className:"border-b",extensions:[Qe.lineWrapping,Je.of([{key:l.getHotkey("global.save").key,stopPropagation:!0,run:()=>m===o.contents?!1:(g(),!0)}])],value:m,onChange:p})})})]})};var _e=t=>t?t.startsWith("image/")||t.startsWith("audio/")||t.startsWith("video/")||t.startsWith("application/pdf"):!1,ue={"application/javascript":"javascript","text/markdown":"markdown","text/html":"html","text/css":"css","text/x-python":"python","application/json":"json","application/xml":"xml","text/x-yaml":"yaml","text/csv":"markdown","text/plain":"markdown",default:"markdown"},Ut=class{constructor(t){M(this,"delegate",new fe([]));M(this,"rootPath","");M(this,"onChange",Le.NOOP);M(this,"path",new de("/"));M(this,"initialize",async t=>{if(this.onChange=t,this.delegate.data.length===0)try{let e=await this.callbacks.listFiles({path:this.rootPath});this.delegate=new fe(e.files),this.rootPath=e.root,this.path=de.guessDeliminator(e.root)}catch(e){A({title:"Failed",description:_t(e)})}this.onChange(this.delegate.data)});M(this,"refreshAll",async t=>{let e=[this.rootPath,...t.map(n=>{var i;return(i=this.delegate.find(n))==null?void 0:i.data.path})].filter(Boolean),r=await Promise.all(e.map(n=>this.callbacks.listFiles({path:n}).catch(()=>({files:[]}))));for(let[n,i]of e.entries()){let l=r[n];i===this.rootPath?this.delegate=new fe(l.files):this.delegate.update({id:i,changes:{children:l.files}})}this.onChange(this.delegate.data)});M(this,"relativeFromRoot",t=>{let e=this.rootPath.endsWith(this.path.deliminator)?this.rootPath:`${this.rootPath}${this.path.deliminator}`;return t.startsWith(e)?t.slice(e.length):t});M(this,"handleResponse",t=>t.success?t:(A({title:"Failed",description:t.message}),null));this.callbacks=t}async expand(t){let e=this.delegate.find(t);if(!e||!e.data.isDirectory)return!1;if(e.children&&e.children.length>0)return!0;let r=await this.callbacks.listFiles({path:e.data.path});return this.delegate.update({id:t,changes:{children:r.files}}),this.onChange(this.delegate.data),!0}async rename(t,e){let r=this.delegate.find(t);if(!r)return;let n=r.data.path,i=this.path.join(this.path.dirname(n),e);await this.callbacks.renameFileOrFolder({path:n,newPath:i}).then(this.handleResponse),this.delegate.update({id:t,changes:{name:e,path:i}}),this.onChange(this.delegate.data),await this.refreshAll([i])}async move(t,e){var n;let r=e?((n=this.delegate.find(e))==null?void 0:n.data.path)??e:this.rootPath;await Promise.all(t.map(i=>{this.delegate.move({id:i,parentId:e,index:0});let l=this.delegate.find(i);if(!l)return Promise.resolve();let c=this.path.join(r,this.path.basename(l.data.path));return this.delegate.update({id:i,changes:{path:c}}),this.callbacks.renameFileOrFolder({path:l.data.path,newPath:c}).then(this.handleResponse)})),this.onChange(this.delegate.data),await this.refreshAll([r])}async createFile(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,n=await this.callbacks.createFileOrFolder({path:r,type:"file",name:t}).then(this.handleResponse);n!=null&&n.info&&(this.delegate.create({parentId:e,index:0,data:n.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async createFolder(t,e){var i;let r=e?((i=this.delegate.find(e))==null?void 0:i.data.path)??e:this.rootPath,n=await this.callbacks.createFileOrFolder({path:r,type:"directory",name:t}).then(this.handleResponse);n!=null&&n.info&&(this.delegate.create({parentId:e,index:0,data:n.info}),this.onChange(this.delegate.data),await this.refreshAll([r]))}async delete(t){let e=this.delegate.find(t);e&&(await this.callbacks.deleteFileOrFolder({path:e.data.path}).then(this.handleResponse),this.delegate.drop({id:t}),this.onChange(this.delegate.data))}};const Pe=je(t=>{let e=t(nt);return Ke(e,"no requestClientAtom set"),new Ut({listFiles:e.sendListFiles,createFileOrFolder:e.sendCreateFileOrFolder,deleteFileOrFolder:e.sendDeleteFileOrFolder,renameFileOrFolder:e.sendRenameFileOrFolder})}),Kt=je({});async function Yt(){await Ee.get(Pe).refreshAll([])}var Zt=1024*1024*100;function Oe(t){let e=(0,Vt.c)(7),r;e[0]===t?r=e[1]:(r=t===void 0?{}:t,e[0]=t,e[1]=r);let n=r,{sendCreateFileOrFolder:i}=pe(),l;e[2]===i?l=e[3]:(l=async m=>{for(let p of m){let o=ta(ea(p)),f="";o&&(f=de.guessDeliminator(o).dirname(o));let j=(await At(p)).split(",")[1];await i({path:f,type:"file",name:p.name,contents:j})}await Yt()},e[2]=i,e[3]=l);let c;return e[4]!==n||e[5]!==l?(c={multiple:!0,maxSize:Zt,onError:Xt,onDropRejected:Gt,onDrop:l,...n},e[4]=n,e[5]=l,e[6]=c):c=e[6],Dt(c)}function Gt(t){A({title:"File upload failed",description:(0,a.jsx)("div",{className:"flex flex-col gap-1",children:t.map(Jt)}),variant:"danger"})}function Jt(t){return(0,a.jsxs)("div",{children:[t.file.name," (",t.errors.map(Qt).join(", "),")"]},t.file.name)}function Qt(t){return t.message}function Xt(t){Ue.error(t),A({title:"File upload failed",description:t.message,variant:"danger"})}function ea(t){if(t.webkitRelativePath)return t.webkitRelativePath;if("path"in t&&typeof t.path=="string")return t.path;if("relativePath"in t&&typeof t.relativePath=="string")return t.relativePath}function ta(t){if(t)return t.replace(/^\/+/,"")}var J=Y(ce(),1),aa=qe("marimo:showHiddenFiles",!0,$e,{getOnInit:!0}),ze=_.createContext(null);const ia=t=>{let e=(0,J.c)(67),{height:r}=t,n=(0,_.useRef)(null),[i]=le(Pe),l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];let[c,m]=(0,_.useState)(l),[p,o]=(0,_.useState)(null),[f,j]=le(aa),{openPrompt:y}=Fe(),[d,g]=le(Kt),v;e[1]===i?v=e[2]:(v=()=>i.initialize(m),e[1]=i,e[2]=v);let x;e[3]===Symbol.for("react.memo_cache_sentinel")?(x=[],e[3]=x):x=e[3];let{isPending:D,error:k}=Ne(v,x),b;e[4]!==d||e[5]!==i?(b=()=>{i.refreshAll(Object.keys(d).filter(h=>d[h]))},e[4]=d,e[5]=i,e[6]=b):b=e[6];let s=W(b),u;e[7]!==j||e[8]!==f?(u=()=>{j(!f)},e[7]=j,e[8]=f,e[9]=u):u=e[9];let z=W(u),F;e[10]!==y||e[11]!==i?(F=async()=>{y({title:"Folder name",onConfirm:async h=>{i.createFolder(h,null)}})},e[10]=y,e[11]=i,e[12]=F):F=e[12];let P=W(F),C;e[13]!==y||e[14]!==i?(C=async()=>{y({title:"File name",onConfirm:async h=>{i.createFile(h,null)}})},e[13]=y,e[14]=i,e[15]=C):C=e[15];let R=W(C),Q;e[16]===g?Q=e[17]:(Q=()=>{var h;(h=n.current)==null||h.closeAll(),g({})},e[16]=g,e[17]=Q);let ne=W(Q);if(D){let h;return e[18]===Symbol.for("react.memo_cache_sentinel")?(h=(0,a.jsx)(yt,{size:"medium",centered:!0}),e[18]=h):h=e[18],h}if(k){let h;return e[19]===k?h=e[20]:(h=(0,a.jsx)(Ce,{error:k}),e[19]=k,e[20]=h),h}if(p){let h;e[21]===Symbol.for("react.memo_cache_sentinel")?(h=()=>o(null),e[21]=h):h=e[21];let w;e[22]===Symbol.for("react.memo_cache_sentinel")?(w=(0,a.jsx)(I,{onClick:h,"data-testid":"file-explorer-back-button",variant:"text",size:"xs",className:"mb-0",children:(0,a.jsx)(st,{size:16})}),e[22]=w):w=e[22];let S;e[23]===p.name?S=e[24]:(S=(0,a.jsxs)("div",{className:"flex items-center pl-1 pr-3 shrink-0 border-b justify-between",children:[w,(0,a.jsx)("span",{className:"font-bold",children:p.name})]}),e[23]=p.name,e[24]=S);let L;e[25]!==p.path||e[26]!==i?(L=Ae=>Me(Ae,i.relativeFromRoot(p.path)),e[25]=p.path,e[26]=i,e[27]=L):L=e[27];let U;e[28]!==p||e[29]!==L?(U=(0,a.jsx)(_.Suspense,{children:(0,a.jsx)(Lt,{onOpenNotebook:L,file:p})}),e[28]=p,e[29]=L,e[30]=U):U=e[30];let ae;return e[31]!==S||e[32]!==U?(ae=(0,a.jsxs)(a.Fragment,{children:[S,U]}),e[31]=S,e[32]=U,e[33]=ae):ae=e[33],ae}let X;e[34]!==c||e[35]!==f?(X=Re(c,f),e[34]=c,e[35]=f,e[36]=X):X=e[36];let oe=X,E;e[37]!==ne||e[38]!==R||e[39]!==P||e[40]!==z||e[41]!==s||e[42]!==i?(E=(0,a.jsx)(na,{onRefresh:s,onHidden:z,onCreateFile:R,onCreateFolder:P,onCollapseAll:ne,tree:i}),e[37]=ne,e[38]=R,e[39]=P,e[40]=z,e[41]=s,e[42]=i,e[43]=E):E=e[43];let se=r-33,H,B,T;e[44]===i?(H=e[45],B=e[46],T=e[47]):(H=async h=>{let{ids:w}=h;for(let S of w)await i.delete(S)},B=async h=>{let{id:w,name:S}=h;await i.rename(w,S)},T=async h=>{let{dragIds:w,parentId:S}=h;await i.move(w,S)},e[44]=i,e[45]=H,e[46]=B,e[47]=T);let ee;e[48]===Symbol.for("react.memo_cache_sentinel")?(ee=h=>{let w=h[0];w&&(w.data.isDirectory||o(w.data))},e[48]=ee):ee=e[48];let q;e[49]!==d||e[50]!==g||e[51]!==i?(q=async h=>{if(await i.expand(h)){let w=d[h]??!1;g({...d,[h]:!w})}},e[49]=d,e[50]=g,e[51]=i,e[52]=q):q=e[52];let $;e[53]!==d||e[54]!==se||e[55]!==H||e[56]!==B||e[57]!==T||e[58]!==q||e[59]!==oe?($=(0,a.jsx)(Pt,{width:"100%",ref:n,height:se,className:"h-full",data:oe,initialOpenState:d,openByDefault:!1,renderCursor:ma,disableDrop:pa,onDelete:H,onRename:B,onMove:T,onSelect:ee,onToggle:q,padding:15,rowHeight:30,indent:ra,overscanCount:1e3,disableMultiSelection:!0,children:la}),e[53]=d,e[54]=se,e[55]=H,e[56]=B,e[57]=T,e[58]=q,e[59]=oe,e[60]=$):$=e[60];let V;e[61]!==$||e[62]!==i?(V=(0,a.jsx)(ze,{value:i,children:$}),e[61]=$,e[62]=i,e[63]=V):V=e[63];let te;return e[64]!==E||e[65]!==V?(te=(0,a.jsxs)(a.Fragment,{children:[E,V]}),e[64]=E,e[65]=V,e[66]=te):te=e[66],te};var ra=15,na=t=>{let e=(0,J.c)(34),{onRefresh:r,onHidden:n,onCreateFile:i,onCreateFolder:l,onCollapseAll:c}=t,m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m={noDrag:!0,noDragEventsBubbling:!0},e[0]=m):m=e[0];let{getRootProps:p,getInputProps:o}=Oe(m),f;e[1]===Symbol.for("react.memo_cache_sentinel")?(f=(0,a.jsx)(ke,{size:16}),e[1]=f):f=e[1];let j;e[2]===i?j=e[3]:(j=(0,a.jsx)(O,{content:"Add file",children:(0,a.jsx)(I,{"data-testid":"file-explorer-add-file-button",onClick:i,variant:"text",size:"xs",children:f})}),e[2]=i,e[3]=j);let y;e[4]===Symbol.for("react.memo_cache_sentinel")?(y=(0,a.jsx)(De,{size:16}),e[4]=y):y=e[4];let d;e[5]===l?d=e[6]:(d=(0,a.jsx)(O,{content:"Add folder",children:(0,a.jsx)(I,{"data-testid":"file-explorer-add-folder-button",onClick:l,variant:"text",size:"xs",children:y})}),e[5]=l,e[6]=d);let g;e[7]===p?g=e[8]:(g=p({}),e[7]=p,e[8]=g);let v,x;e[9]===Symbol.for("react.memo_cache_sentinel")?(v=Ge({variant:"text",size:"xs"}),x=(0,a.jsx)(Ct,{size:16}),e[9]=v,e[10]=x):(v=e[9],x=e[10]);let D;e[11]===g?D=e[12]:(D=(0,a.jsx)(O,{content:"Upload file",children:(0,a.jsx)("button",{"data-testid":"file-explorer-upload-button",...g,className:v,children:x})}),e[11]=g,e[12]=D);let k;e[13]===o?k=e[14]:(k=o({}),e[13]=o,e[14]=k);let b;e[15]===k?b=e[16]:(b=(0,a.jsx)("input",{...k,type:"file"}),e[15]=k,e[16]=b);let s;e[17]===Symbol.for("react.memo_cache_sentinel")?(s=(0,a.jsx)(bt,{size:16}),e[17]=s):s=e[17];let u;e[18]===r?u=e[19]:(u=(0,a.jsx)(O,{content:"Refresh",children:(0,a.jsx)(I,{"data-testid":"file-explorer-refresh-button",onClick:r,variant:"text",size:"xs",children:s})}),e[18]=r,e[19]=u);let z;e[20]===Symbol.for("react.memo_cache_sentinel")?(z=(0,a.jsx)(ut,{size:16}),e[20]=z):z=e[20];let F;e[21]===n?F=e[22]:(F=(0,a.jsx)(O,{content:"Toggle hidden files",children:(0,a.jsx)(I,{"data-testid":"file-explorer-hidden-files-button",onClick:n,variant:"text",size:"xs",children:z})}),e[21]=n,e[22]=F);let P;e[23]===Symbol.for("react.memo_cache_sentinel")?(P=(0,a.jsx)(Bt,{size:16}),e[23]=P):P=e[23];let C;e[24]===c?C=e[25]:(C=(0,a.jsx)(O,{content:"Collapse all folders",children:(0,a.jsx)(I,{"data-testid":"file-explorer-collapse-button",onClick:c,variant:"text",size:"xs",children:P})}),e[24]=c,e[25]=C);let R;return e[26]!==b||e[27]!==u||e[28]!==F||e[29]!==C||e[30]!==j||e[31]!==d||e[32]!==D?(R=(0,a.jsxs)("div",{className:"flex items-center justify-end px-2 shrink-0 border-b",children:[j,d,D,b,u,F,C]}),e[26]=b,e[27]=u,e[28]=F,e[29]=C,e[30]=j,e[31]=d,e[32]=D,e[33]=R):R=e[33],R},oa=t=>{let e=(0,J.c)(9),{node:r,onOpenMarimoFile:n}=t,i;e[0]===r?i=e[1]:(i=m=>{r.data.isDirectory||(m.stopPropagation(),r.select())},e[0]=r,e[1]=i);let l;e[2]!==r.data.isMarimoFile||e[3]!==n?(l=r.data.isMarimoFile&&!ie()&&(0,a.jsxs)("span",{className:"shrink-0 ml-2 text-sm hidden group-hover:inline hover:underline",onClick:n,children:["open ",(0,a.jsx)(he,{className:"inline ml-1",size:12})]}),e[2]=r.data.isMarimoFile,e[3]=n,e[4]=l):l=e[4];let c;return e[5]!==r.data.name||e[6]!==i||e[7]!==l?(c=(0,a.jsxs)("span",{className:"flex-1 overflow-hidden text-ellipsis",onClick:i,children:[r.data.name,l]}),e[5]=r.data.name,e[6]=i,e[7]=l,e[8]=c):c=e[8],c},sa=t=>{let e=(0,J.c)(10),{node:r}=t,n=(0,_.useRef)(null),i,l;e[0]===r.data.name?(i=e[1],l=e[2]):(i=()=>{var o,f;(o=n.current)==null||o.focus(),(f=n.current)==null||f.setSelectionRange(0,r.data.name.lastIndexOf("."))},l=[r.data.name],e[0]=r.data.name,e[1]=i,e[2]=l),(0,_.useEffect)(i,l);let c,m;e[3]===r?(c=e[4],m=e[5]):(c=()=>r.reset(),m=o=>{o.key==="Escape"&&r.reset(),o.key==="Enter"&&r.submit(o.currentTarget.value)},e[3]=r,e[4]=c,e[5]=m);let p;return e[6]!==r.data.name||e[7]!==c||e[8]!==m?(p=(0,a.jsx)("input",{ref:n,className:"flex-1 bg-transparent border border-border text-muted-foreground",defaultValue:r.data.name,onClick:ha,onBlur:c,onKeyDown:m}),e[6]=r.data.name,e[7]=c,e[8]=m,e[9]=p):p=e[9],p},la=({node:t,style:e,dragHandle:r})=>{let{openFile:n,sendCreateFileOrFolder:i,sendFileDetails:l}=pe(),c=t.data.isDirectory?"directory":gt(t.data.name),m=jt[c],{openConfirm:p,openPrompt:o}=Fe(),{createNewCell:f}=Ve(),j=It(),y=s=>{f({code:s,before:!1,cellId:j??"__end__"})},d=(0,_.use)(ze),g=async s=>{Me(s,d?d.relativeFromRoot(t.data.path):t.data.path)},v=async s=>{s.stopPropagation(),s.preventDefault(),p({title:"Delete file",description:`Are you sure you want to delete ${t.data.name}?`,confirmAction:(0,a.jsx)(St,{onClick:async()=>{await t.tree.delete(t.id)},"aria-label":"Confirm",children:"Delete"})})},x=W(async()=>{t.open(),o({title:"Folder name",onConfirm:async s=>{d==null||d.createFolder(s,t.id)}})}),D=W(async()=>{t.open(),o({title:"File name",onConfirm:async s=>{d==null||d.createFile(s,t.id)}})}),k=W(async()=>{var F;if(!d||t.data.isDirectory)return;let[s,u]=Nt(t.data.name),z=`${s}_copy${u}`;try{let P=await l({path:t.data.path}),C=((F=t.parent)==null?void 0:F.data.path)||"";await i({path:C,type:"file",name:z,contents:P.contents?btoa(P.contents):void 0}),await d.refreshAll([C])}catch{A({title:"Failed to duplicate file",description:"Unable to create a duplicate of the file",variant:"danger"})}}),b=()=>{let s={size:14,strokeWidth:1.5,className:"mr-2"};return(0,a.jsxs)(ht,{align:"end",className:"no-print w-[220px]",onClick:u=>u.stopPropagation(),onCloseAutoFocus:u=>u.preventDefault(),children:[!t.data.isDirectory&&(0,a.jsxs)(N,{onSelect:()=>t.select(),children:[(0,a.jsx)($t,{...s}),"Open file"]}),!t.data.isDirectory&&!ie()&&(0,a.jsxs)(N,{onSelect:()=>{n({path:t.data.path})},children:[(0,a.jsx)(he,{...s}),"Open file in external editor"]}),t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(N,{onSelect:()=>D(),children:[(0,a.jsx)(ke,{...s}),"Create file"]}),(0,a.jsxs)(N,{onSelect:()=>x(),children:[(0,a.jsx)(De,{...s}),"Create folder"]}),(0,a.jsx)(Z,{})]}),(0,a.jsxs)(N,{onSelect:()=>t.edit(),children:[(0,a.jsx)(Tt,{...s}),"Rename"]}),!t.data.isDirectory&&(0,a.jsxs)(N,{onSelect:k,children:[(0,a.jsx)(be,{...s}),"Duplicate"]}),(0,a.jsxs)(N,{onSelect:async()=>{await re(t.data.path),A({title:"Copied to clipboard"})},children:[(0,a.jsx)(Se,{...s}),"Copy path"]}),d&&(0,a.jsxs)(N,{onSelect:async()=>{await re(d.relativeFromRoot(t.data.path)),A({title:"Copied to clipboard"})},children:[(0,a.jsx)(Se,{...s}),"Copy relative path"]}),(0,a.jsx)(Z,{}),(0,a.jsxs)(N,{onSelect:()=>{let{path:u}=t.data;y(we[c](u))},children:[(0,a.jsx)(lt,{...s}),"Insert snippet for reading file"]}),(0,a.jsxs)(N,{onSelect:async()=>{A({title:"Copied to clipboard",description:"Code to open the file has been copied to your clipboard. You can also drag and drop this file into the editor"});let{path:u}=t.data;await re(we[c](u))},children:[(0,a.jsx)(Te,{...s}),"Copy snippet for reading file"]}),t.data.isMarimoFile&&!ie()&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z,{}),(0,a.jsxs)(N,{onSelect:g,children:[(0,a.jsx)(qt,{...s}),"Open notebook"]})]}),(0,a.jsx)(Z,{}),!t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(N,{onSelect:async()=>{let u=(await l({path:t.data.path})).contents||"";ye(new Blob([u]),t.data.name)},children:[(0,a.jsx)(ve,{...s}),"Download"]}),(0,a.jsx)(Z,{})]}),(0,a.jsxs)(N,{onSelect:v,variant:"danger",children:[(0,a.jsx)(kt,{...s}),"Delete"]})]})};return(0,a.jsxs)("div",{style:e,ref:r,className:me("flex items-center cursor-pointer ml-1 text-muted-foreground whitespace-nowrap group"),draggable:!0,onClick:s=>{s.stopPropagation(),t.data.isDirectory&&t.toggle()},children:[(0,a.jsx)(da,{node:t}),(0,a.jsxs)("span",{className:me("flex items-center pl-1 py-1 cursor-pointer hover:bg-accent/50 hover:text-accent-foreground rounded-l flex-1 overflow-hidden group",t.willReceiveDrop&&t.data.isDirectory&&"bg-accent/80 hover:bg-accent/80 text-accent-foreground"),children:[t.data.isMarimoFile?(0,a.jsx)("img",{src:Ht,className:"w-5 h-5 shrink-0 mr-2 filter grayscale",alt:"Marimo"}):(0,a.jsx)(m,{className:"w-5 h-5 shrink-0 mr-2",strokeWidth:1.5}),t.isEditing?(0,a.jsx)(sa,{node:t}):(0,a.jsx)(oa,{node:t,onOpenMarimoFile:g}),(0,a.jsxs)(ft,{modal:!1,children:[(0,a.jsx)(pt,{asChild:!0,tabIndex:-1,onClick:s=>s.stopPropagation(),children:(0,a.jsx)(I,{"data-testid":"file-explorer-more-button",variant:"text",tabIndex:-1,size:"xs",className:"mb-0","aria-label":"More options",children:(0,a.jsx)(xt,{strokeWidth:2,className:"w-5 h-5 hidden group-hover:block"})})}),b()]})]})]})},da=t=>{let e=(0,J.c)(3),{node:r}=t;if(!r.data.isDirectory){let i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,a.jsx)("span",{className:"w-5 h-5 shrink-0"}),e[0]=i):i=e[0],i}let n;return e[1]===r.isOpen?n=e[2]:(n=r.isOpen?(0,a.jsx)(dt,{className:"w-5 h-5 shrink-0"}):(0,a.jsx)(mt,{className:"w-5 h-5 shrink-0"}),e[1]=r.isOpen,e[2]=n),n};function Me(t,e){t.stopPropagation(),t.preventDefault(),Et(e)}function Re(t,e){if(e)return t;let r=[];for(let n of t){if(ca(n.name))continue;let i=n;if(n.children&&n.children.length){let l=Re(n.children,e);l!==n.children&&(i={...n,children:l})}r.push(i)}return r}function ca(t){return!!t.startsWith(".")}function ma(){return null}function pa(t){let{parentNode:e}=t;return!e.data.isDirectory}function ha(t){return t.stopPropagation()}var fa=Y(ce(),1),xa=()=>{let t=(0,fa.c)(20),{ref:e,height:r}=Wt(),n=r===void 0?1:r,i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={noClick:!0,noKeyboard:!0},t[0]=i):i=t[0];let{getRootProps:l,getInputProps:c,isDragActive:m}=Oe(i),p;t[1]===l?p=t[2]:(p=l(),t[1]=l,t[2]=p);let o;t[3]===Symbol.for("react.memo_cache_sentinel")?(o=me("flex flex-col flex-1 overflow-hidden relative"),t[3]=o):o=t[3];let f;t[4]===c?f=t[5]:(f=c(),t[4]=c,t[5]=f);let j;t[6]===f?j=t[7]:(j=(0,a.jsx)("input",{...f}),t[6]=f,t[7]=j);let y;t[8]===m?y=t[9]:(y=m&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center uppercase justify-center text-xl font-bold text-primary/90 bg-accent/85 z-10 border-2 border-dashed border-primary/90 rounded-lg pointer-events-none",children:"Drop files here"}),t[8]=m,t[9]=y);let d;t[10]===n?d=t[11]:(d=(0,a.jsx)(ia,{height:n}),t[10]=n,t[11]=d);let g;t[12]!==e||t[13]!==d?(g=(0,a.jsx)("div",{ref:e,className:"flex flex-col flex-1 overflow-hidden",children:d}),t[12]=e,t[13]=d,t[14]=g):g=t[14];let v;return t[15]!==p||t[16]!==j||t[17]!==y||t[18]!==g?(v=(0,a.jsxs)("div",{...p,className:o,children:[j,y,g]}),t[15]=p,t[16]=j,t[17]=y,t[18]=g,t[19]=v):v=t[19],v};export{xa as default};
